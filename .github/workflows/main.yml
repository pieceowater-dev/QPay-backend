name: Update Parent Repo

on:
  push:
    branches:
      - main 

jobs:
  update_parent_repo:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Configure Git
      run: |
        git config --global user.name "pieceowater"
        git config --global user.email "pieceowater@gmail.com"

    - name: Clone parent repo
      run: |
        git clone https://${{ vars.GH_NAME }}:${{ secrets.GH_PAT }}@github.com/pieceowater/QPay.git parent_repo

    - name: Update submodule in parent repo
      run: |
        cd parent_repo
        git submodule update --remote --recursive --init --quiet
        # Set up authentication for the submodule
        git config --global credential.helper 'store --file ~/.git-credentials'
        echo "https://${{ secrets.GH_NAME }}:${{ secrets.GH_PAT }}" > ~/.git-credentials
        git submodule update --remote --init --recursive
        git config --global --unset credential.helper
        
    - name: Add and commit submodule changes
      run: |
        cd parent_repo
        git add .
        git commit -m "${{ github.repository }}"
    
    - name: Push changes to parent repo
      run: |
        cd parent_repo
        git push origin main
